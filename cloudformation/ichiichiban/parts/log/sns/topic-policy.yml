---
AWSTemplateFormatVersion: 2010-09-09
Description:
  Setting up Log SNS Topic Policy
Parameters:
  TopicArn:
    Type       : String
    Description: The ARN of log SNS topic
    MinLength  : 1
  ApiLogAlarmErrorArn:
    Type       : String
    Description: The ARN of API log alarm Error
    MinLength  : 1
  ApiLogAlarmWarnArn:
    Type       : String
    Description: The ARN of API log alarm Warn
    MinLength  : 1
  ApiLogAlarmFatalArn:
    Type       : String
    Description: The ARN of API log alarm Fatal
    MinLength  : 1
  WebLogAlarmErrorArn:
    Type       : String
    Description: The ARN of API log alarm Error
    MinLength  : 1
  WebLogAlarmWarnArn:
    Type       : String
    Description: The ARN of API log alarm Warn
    MinLength  : 1
  WebLogAlarmFatalArn:
    Type       : String
    Description: The ARN of API log alarm Fatal
    MinLength  : 1
  BatchLogAlarmErrorArn:
    Type       : String
    Description: The ARN of API log alarm Error
    MinLength  : 1
  BatchLogAlarmWarnArn:
    Type       : String
    Description: The ARN of API log alarm Warn
    MinLength  : 1
  BatchLogAlarmFatalArn:
    Type       : String
    Description: The ARN of API log alarm Fatal
    MinLength  : 1
Resources:
  # ---------------------------------------------------------------#
  # Create SNS Topic Policy
  # ---------------------------------------------------------------#
  # https://docs.aws.amazon.com/ja_jp/AWSCloudFormation/latest/UserGuide/aws-properties-sns-policy.html
  SnsTopicPolicy:
    Type      : AWS::SNS::TopicPolicy
    Properties:
      PolicyDocument:
        Version  : "2012-10-17"
        Statement:
          - Effect   : Allow
            Principal:
              "AWS": "*"
            Action   :
              - "sns:Publish"
            Resource : !Ref TopicArn
            Condition:
              StringEquals:
                "AWS:SourceOwner": !Ref "AWS::AccountId"
              ArnLike     :
                "AWS:SourceArn"  : !Ref ApiLogAlarmErrorArn
                "AWS:SourceArn"  : !Ref ApiLogAlarmWarnArn
                "AWS:SourceArn"  : !Ref ApiLogAlarmFatalArn
                "AWS:SourceArn"  : !Ref WebLogAlarmErrorArn
                "AWS:SourceArn"  : !Ref WebLogAlarmWarnArn
                "AWS:SourceArn"  : !Ref WebLogAlarmFatalArn
                "AWS:SourceArn"  : !Ref BatchLogAlarmErrorArn
                "AWS:SourceArn"  : !Ref BatchLogAlarmWarnArn
                "AWS:SourceArn"  : !Ref BatchLogAlarmFatalArn
      Topics        :
        - !Ref TopicArn