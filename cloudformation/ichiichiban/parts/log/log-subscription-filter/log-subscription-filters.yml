---
AWSTemplateFormatVersion: 2010-09-09
Description:
  Setting up Log Subscription Filter
Parameters:
  ProductName:
    Type       : String
    Description: Product Name (Ex. MansionValue)
    MinLength  : 1
  Environment:
    Type         : String
    Default      : Stg
    AllowedValues:
      - Stg
      - Prod
    Description  : Select Environment
    MinLength    : 1
  ApiDestinationArn:
    Type       : String
    Description: The ARN of Api Destination
    MinLength  : 1
  ApiLogGroupName:
    Type       : String
    Description: Log Group Api Name
    MinLength  : 1
  WebDestinationArn:
    Type       : String
    Description: The ARN of Web Destination
    MinLength  : 1
  WebLogGroupName:
    Type       : String
    Description: Log Group Web Name
    MinLength  : 1
Resources:
  # ---------------------------------------------------------------#
  # Create Log Subscription Filters
  # ---------------------------------------------------------------#
  ApiLogSubscriptionFilterRole:
    Type      : AWS::CloudFormation::Stack
    Properties:
      Parameters:
        ProductName      : !Ref ProductName
        Environment      : !Ref Environment
        DeliveryStreamArn: !Ref ApiDestinationArn
        RoleName         : !Sub "${ProductName}-${Environment}-Api-LogSubscriptionFilterRole"
      TemplateURL: ./log-subscription-filter-role.yml
  ApiLogSubscriptionFilter:
    Type      : AWS::CloudFormation::Stack
    Properties:
      Parameters:
        DestinationArn: !Ref ApiDestinationArn
        LogGroupName  : !Ref ApiLogGroupName
        RoleArn       : !GetAtt ApiLogSubscriptionFilterRole.Outputs.LogSubscriptionFilterRoleArn
      TemplateURL: ./log-subscription-filter.yml
  WebLogSubscriptionFilterRole:
    Type      : AWS::CloudFormation::Stack
    Properties:
      Parameters:
        ProductName      : !Ref ProductName
        Environment      : !Ref Environment
        DeliveryStreamArn: !Ref WebDestinationArn
        RoleName         : !Sub "${ProductName}-${Environment}-Web-LogSubscriptionFilterRole"
      TemplateURL: ./log-subscription-filter-role.yml
  WebLogSubscriptionFilter:
    Type      : AWS::CloudFormation::Stack
    Properties:
      Parameters:
        DestinationArn: !Ref WebDestinationArn
        LogGroupName  : !Ref WebLogGroupName
        RoleArn       : !GetAtt WebLogSubscriptionFilterRole.Outputs.LogSubscriptionFilterRoleArn
      TemplateURL: ./log-subscription-filter.yml